{"version":3,"sources":["help-me.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\nvar fs = require('fs')\nvar path = require('path')\nvar through = require('through2')\nvar globStream = require('glob-stream')\nvar concat = require('callback-stream')\nvar xtend = require('xtend')\n\nvar defaults = {\n  dir: path.join(path.dirname(require.main.filename), 'doc'),\n  ext: '.txt',\n  help: 'help'\n}\n\nfunction helpMe (opts) {\n  opts = xtend(defaults, opts)\n\n  if (!opts.dir) {\n    throw new Error('missing directory')\n  }\n\n  return {\n    createStream: createStream,\n    toStdout: toStdout\n  }\n\n  function createStream (args) {\n    if (typeof args === 'string') {\n      args = args.split(' ')\n    } else if (!args || args.length === 0) {\n      args = [opts.help]\n    }\n\n    var out = through()\n    var gs = globStream([opts.dir + '/**/*' + opts.ext])\n    var re = new RegExp(args.map(function (arg) {\n      return arg + '[a-zA-Z0-9]*'\n    }).join('[ /]+'))\n\n    gs.pipe(concat({ objectMode: true }, function (err, files) {\n      if (err) return out.emit('error', err)\n\n      files = files.map(function (file) {\n        file.relative = file.path.replace(file.base, '').replace(/^\\//, '')\n        return file\n      }).filter(function (file) {\n        return file.relative.match(re)\n      })\n\n      if (files.length === 0) {\n        return out.emit('error', new Error('no such help file'))\n      } else if (files.length > 1) {\n        out.write('There are ' + files.length + ' help pages ')\n        out.write('that matches the given request, please disambiguate:\\n')\n        files.forEach(function (file) {\n          out.write('  * ')\n          out.write(file.relative.replace(opts.ext, ''))\n          out.write('\\n')\n        })\n        out.end()\n        return\n      }\n\n      fs.createReadStream(files[0].path)\n        .on('error', function (err) {\n          out.emit('error', err)\n        })\n        .pipe(out)\n    }))\n\n    return out\n  }\n\n  function toStdout (args) {\n    createStream(args)\n      .on('error', function () {\n        console.log('no such help file\\n')\n        toStdout()\n      })\n      .pipe(process.stdout)\n  }\n}\n\nmodule.exports = helpMe\n"]}